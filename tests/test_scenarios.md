# Тестовые сценарии и результаты валидации OncoHelp

Данный раздел описывает сценарии тестирования и результаты валидации прототипа системы **OncoHelp** — AI-ассистента для проверки соответствия лечения онкологических пациентов клиническим рекомендациям.

Тестирование проводилось на наборе обезличенных клинических историй болезни и носило **итеративный характер**: выявленные в ходе проверки ошибки использовались для доработки логики системы и промптов.

---

## 1. Базовые клинические сценарии

### 1.1 Полный клинический кейс

**Описание сценария:**  
В истории болезни указаны диагноз, стадия заболевания, морфология и лечение, полностью соответствующее клиническим рекомендациям.

**Ожидаемое поведение системы:**
- классификация лечения как «соответствует»;
- отсутствие ложных флагов и предупреждений;
- использование релевантных источников (RUSSCO / Минздрав РФ).

**Результат тестирования:**  
Система корректно определяет полное соответствие лечения клиническим рекомендациям.  
Ошибок классификации в данном типе сценариев не выявлено.

---

### 1.2 Частичное соответствие лечения

**Описание сценария:**  
В истории болезни указано лечение, однако отсутствуют ключевые параметры (например, стадия заболевания).

**Ожидаемое поведение системы:**
- классификация как «частично соответствует»;
- указание недостающих данных;
- отсутствие клинических выводов, не основанных на имеющейся информации.

**Результат тестирования:**  
Система корректно выявляет неполноту данных.  
На ранних этапах тестирования фиксировались неточности в формулировках, которые были устранены в ходе доработки промпта.

---

### 1.3 Явное несоответствие клиническим рекомендациям

**Описание сценария:**  
В плане лечения отсутствует обязательный этап терапии, предусмотренный рекомендациями.

**Ожидаемое поведение системы:**
- классификация как «не соответствует»;
- указание отсутствующего этапа лечения;
- ссылка на источник клинических рекомендаций.

**Результат тестирования:**  
Система корректно выявляет несоответствие.  
Ранее выявленные ошибки, связанные с недостаточно чётким указанием источников, были исправлены в процессе тестирования.

---

### 1.4 Конфликт или ошибка назначения

**Описание сценария:**  
В тексте истории болезни указаны противоречащие друг другу назначения или взаимоисключающие режимы лечения.

**Ожидаемое поведение системы:**
- выявление конфликта;
- классификация как «частично соответствует» или «требует уточнения»;
- отсутствие попыток разрешить конфликт самостоятельно.

**Результат тестирования:**  
Система корректно фиксирует противоречия.  
На ранних итерациях тестирования система пыталась интерпретировать конфликт как несоответствие; данное поведение было скорректировано.

---

## 2. Прошлое и текущее лечение

### 2.1 Прошлое лечение соответствовало, текущее — нет

**Описание сценария:**  
История болезни содержит корректно проведённое прошлое лечение и текущее лечение с отклонениями от рекомендаций.

**Ожидаемое поведение системы:**
- независимая оценка прошлого и текущего лечения;
- разные статусы и проценты соответствия.

**Результат тестирования:**  
Система корректно разделяет этапы лечения.  
Ошибки смешения этапов, выявленные на ранних тестах, были устранены.

---

### 2.2 Прошлое лечение неизвестно, текущее указано

**Описание сценария:**  
Отсутствуют данные о прошлом лечении, но указано текущее или планируемое лечение.

**Ожидаемое поведение системы:**
- классификация прошлого лечения как «невозможно оценить из-за недостатка данных»;
- список недостающих данных;
- корректная оценка текущего лечения.

**Результат тестирования:**  
Система корректно обрабатывает отсутствие данных.  
Попытки делать предположения на ранних этапах тестирования были исключены.

---

### 2.3 В истории болезни указано только прошлое лечение

**Описание сценария:**  
История болезни содержит сведения только о ранее проведённом лечении.

**Ожидаемое поведение системы:**
- оценка прошлого лечения;
- указание отсутствия данных о текущем лечении.

**Результат тестирования:**  
Система корректно оценивает только доступный этап лечения.

---

## 3. Особые клинические группы

### 3.1 Пожилые пациенты

**Описание сценария:**  
Возраст пациента явно указан (65 лет и старше).

**Ожидаемое поведение системы:**
- выявление принадлежности к особой группе;
- учёт ограничений клинических рекомендаций.

**Результат тестирования:**  
Система корректно учитывает возраст пациента.  
Формулировки были уточнены в ходе тестирования для исключения клинических рекомендаций от имени системы.

---

### 3.2 Беременность

**Описание сценария:**  
В истории болезни явно указана беременность.

**Ожидаемое поведение системы:**
- учёт беременности как значимого фактора;
- отражение этого в выводе и источниках.

**Результат тестирования:**  
Система корректно учитывает беременность.  
Выявленные ранее попытки избыточной интерпретации были устранены.

---

### 3.3 Сомнительная беременность

**Описание сценария:**  
Беременность упоминается в анамнезе, но не подтверждена в текущий момент.

**Ожидаемое поведение системы:**
- интерпретация как «неясно / требует уточнения»;
- отсутствие категоричных выводов.

**Результат тестирования:**  
Система корректно интерпретирует неоднозначные данные после доработки логики.

---

## 4. Конфликт источников: Минздрав РФ и RUSSCO

### 4.1 Расхождение рекомендаций

**Описание сценария:**  
Клинические рекомендации Минздрава РФ и RUSSCO содержат различные подходы.

**Ожидаемое поведение системы:**
- отображение обеих позиций;
- явное указание источников.

**Результат тестирования:**  
Система корректно отражает расхождения.  
Ранее выявленные случаи смешения источников были исправлены.

---

### 4.2 Рекомендация присутствует только в одном источнике

**Описание сценария:**  
Нужный пункт присутствует только в рекомендациях Минздрава РФ.

**Ожидаемое поведение системы:**
- указание отсутствия данного пункта в рекомендациях RUSSCO;
- отсутствие вымышленных данных.

**Результат тестирования:**  
Система корректно работает с неполными источниками.  
Галлюцинации рекомендаций были устранены в ходе тестирования.

---

## 5. Устойчивость к формату документа

### 5.1 Разные форматы истории болезни

**Описание сценария:**  
Один и тот же кейс представлен в разных форматах текста.

**Ожидаемое поведение системы:**
- одинаковая клиническая суть вывода.

**Результат тестирования:**  
Система сохраняет корректность анализа независимо от формата.  
Ошибки извлечения данных, выявленные на ранних итерациях, были устранены.

---

### 5.2 Большой объём документа

**Описание сценария:**  
История болезни большого объёма (многостраничный документ).

**Ожидаемое поведение системы:**
- корректная обработка документа;
- сохранение структуры ответа.

**Результат тестирования:**  
Система устойчиво работает с большими объёмами данных.

---

## 6. Диалоговый режим

### 6.1 Вопрос «Почему это несоответствие?»

**Ожидаемое поведение системы:**
- краткий ответ;
- ссылка на источник;
- отсутствие повторного полного отчёта.

**Результат тестирования:**  
Система отвечает по существу.  
Ранее выявленные повторы полного анализа были устранены.

---

### 6.2 Вопрос «Каких данных не хватает?»

**Ожидаемое поведение системы:**
- список недостающих данных;
- пояснение, зачем они нужны.

**Результат тестирования:**  
Система корректно формирует ответ.

---

### 6.3 Серия вопросов подряд

**Описание сценария:**  
Серия последовательных вопросов после основного анализа.

**Ожидаемое поведение системы:**
- сохранение контекста;
- отсутствие повторной обработки всей истории болезни.

**Результат тестирования:**  
Система корректно работает в диалоговом режиме.  
Избыточное потребление токенов, выявленное на ранних тестах, было снижено.

---

## Итог

В ходе итеративного тестирования прототипа OncoHelp:
- выявленные ошибки логики и формулировок были последовательно устранены;
- устойчивость и воспроизводимость выводов системы были повышены;
- система достигла стабильного поведения в ключевых клинических сценариях.

Проведённая валидация подтверждает готовность прототипа к дальнейшему развитию и масштабированию.
